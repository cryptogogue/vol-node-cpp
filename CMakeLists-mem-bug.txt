cmake_minimum_required ( VERSION 3.10.2 )
project ( volition )

set ( CMAKE_CXX_STANDARD 14 )
#set ( CMAKE_CXX_STANDARD_REQUIRED ON )
#set ( CMAKE_BUILD_TYPE "RelWithDebInfo" )

#set ( CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -D_XOPEN_SOURCE=500 -D_REENTRANT -D_THREAD_SAFE -D_FILE_OFFSET_BITS=64 -D_LARGEFILE64_SOURCE" )

#add_definitions ( -DPOCO_ENABLE_CPP11 )
#add_definitions ( -DPOCO_ENABLE_CPP14 )

get_filename_component ( VOLITION_ROOT "./" ABSOLUTE )

################################################

#[[
set ( MOCO_INCLUDES 
    JSON/include/
)

add_library ( MocoJSON "" )

target_include_directories ( MocoJSON PRIVATE ${MOCO_INCLUDES} )

target_sources ( MocoJSON
    PRIVATE
        JSON/src/Array.cpp
        JSON/src/Handler.cpp
        JSON/src/JSONException.cpp
        JSON/src/Object.cpp
        JSON/src/ParseHandler.cpp
        JSON/src/Parser.cpp
        JSON/src/ParserImpl.cpp
        JSON/src/pdjson.c
        JSON/src/PrintHandler.cpp
        JSON/src/Query.cpp
        JSON/src/Stringifier.cpp
        JSON/src/Template.cpp
        JSON/src/TemplateCache.cpp
)
]]

################################################

set ( VOLITION_INCLUDES 
    src/
    /usr/local/opt/openssl/include/
)

add_library ( volition-lib "" )

target_include_directories ( volition-lib PRIVATE ${VOLITION_INCLUDES} )

target_sources ( volition-lib
    PRIVATE
        src/volition/JSONObject.cpp
)

add_executable ( volition "" )

add_dependencies ( volition
    volition-lib
)

target_include_directories ( volition PRIVATE ${VOLITION_INCLUDES} )

target_sources ( volition
    PRIVATE
        src/volition/main-memtest.cpp
)

#include ( cmake/cmake-modules/FindOpenSSL.cmake )
find_package ( OpenSSL REQUIRED )

target_link_libraries ( volition
    volition-lib
    PocoCrypto
    PocoEncodings
    PocoNet
    PocoNetSSL
    PocoUtil
    PocoJSON
    PocoXML
    PocoZip
    PocoFoundation
    pthread
    ${OPENSSL_LIBRARIES}
    ${CMAKE_DL_LIBS}
)

install ( TARGETS volition DESTINATION bin )
